#!/usr/bin/env node

/**
 * üß™ –¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å –±–æ–ª—å—à–∏–º –ø—Ä–æ–º–ø—Ç–æ–º
 */

import claudeService from './src/services/ClaudeService.js';
import dbManager from './src/database/Database.js';
import dotenv from 'dotenv';

dotenv.config();

async function testBigCache() {
  console.log('üöÄ –¢–ï–°–¢ –ö–ï–®–ò–†–û–í–ê–ù–ò–Ø –° –ë–û–õ–¨–®–ò–ú –ü–†–û–ú–ü–¢–û–ú\n');

  try {
    await dbManager.initialize();

    // –°–æ–∑–¥–∞–µ–º –û–ß–ï–ù–¨ –¥–ª–∏–Ω–Ω—ã–π system prompt (>4000 —Å–∏–º–≤–æ–ª–æ–≤ = >1000 —Ç–æ–∫–µ–Ω–æ–≤)
    const systemPrompt = `–¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ú–∞—Ä–∏–∏ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω—ã –ü–µ—Ç—Ä–æ–≤–æ–π, 32 –≥–æ–¥–∞, –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –≤ –∫—Ä—É–ø–Ω–æ–π IT –∫–æ–º–ø–∞–Ω–∏–∏.

–ü–û–î–†–û–ë–ù–ê–Ø –ë–ò–û–ì–†–ê–§–ò–Ø:
–ú–∞—Ä–∏—è —Ä–æ–¥–∏–ª–∞—Å—å –≤ –ú–æ—Å–∫–≤–µ –≤ —Å–µ–º—å–µ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –∏ —É—á–∏—Ç–µ–ª—å–Ω–∏—Ü—ã. –û—Ç–µ—Ü - –í–ª–∞–¥–∏–º–∏—Ä –ü–µ—Ç—Ä–æ–≤–∏—á, —Ä–∞–±–æ—Ç–∞–ª –≥–ª–∞–≤–Ω—ã–º –∏–Ω–∂–µ–Ω–µ—Ä–æ–º –Ω–∞ –∑–∞–≤–æ–¥–µ, –≤—Å–µ–≥–¥–∞ –±—ã–ª —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –∏ —Å—Ç—Ä–æ–≥–∏–º. –ú–∞—Ç—å - –ï–ª–µ–Ω–∞ –ò–≤–∞–Ω–æ–≤–Ω–∞, –ø—Ä–µ–ø–æ–¥–∞–≤–∞–ª–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –≤ —à–∫–æ–ª–µ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–¥–µ—Ä–∂–∞–Ω–Ω–∞—è, —Ä–µ–¥–∫–æ –≤—ã—Ä–∞–∂–∞–ª–∞ —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞ –æ—Ç–∫—Ä—ã—Ç–æ. 

–í –¥–µ—Ç—Å—Ç–≤–µ –ú–∞—Ä–∏—è –±—ã–ª–∞ –æ—á–µ–Ω—å –ø–æ—Å–ª—É—à–Ω—ã–º —Ä–µ–±–µ–Ω–∫–æ–º, –≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–µ–º–∏–ª–∞—Å—å –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—è—Ç–µ—Ä–∫–∏, —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∞ –≤–æ –≤—Å–µ—Ö –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö –∏ –∫–æ–Ω–∫—É—Ä—Å–∞—Ö. –†–æ–¥–∏—Ç–µ–ª–∏ –≤–æ–∑–ª–∞–≥–∞–ª–∏ –Ω–∞ –Ω–µ–µ –±–æ–ª—å—à–∏–µ –Ω–∞–¥–µ–∂–¥—ã, —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä–∏–ª–∏: "–¢—ã –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª—É—á—à–µ –≤—Å–µ—Ö". –≠—Ç–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–æ —É –Ω–µ—ë –≥–ª—É–±–æ–∫–∏–π –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º –∏ —Å—Ç—Ä–∞—Ö —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö.

–í —à–∫–æ–ª–µ –±—ã–ª–∞ –æ—Ç–ª–∏—á–Ω–∏—Ü–µ–π, —Å—Ç–∞—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Å–∞, –ø—Ä–∏–Ω–∏–º–∞–ª–∞ —É—á–∞—Å—Ç–∏–µ –≤ –Ω–∞—É—á–Ω—ã—Ö –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è—Ö. –î—Ä—É–∑–µ–π –±—ã–ª–æ –º–∞–ª–æ - –æ–Ω–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–ª–∞ —É—á–µ–±—É –æ–±—â–µ–Ω–∏—é —Å–æ —Å–≤–µ—Ä—Å—Ç–Ω–∏–∫–∞–º–∏. –ü–æ—Å–ª–µ —à–∫–æ–ª—ã –ø–æ—Å—Ç—É–ø–∏–ª–∞ –≤ –ú–ì–£ –Ω–∞ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç, –∑–∞–∫–æ–Ω—á–∏–ª–∞ —Å –∫—Ä–∞—Å–Ω—ã–º –¥–∏–ø–ª–æ–º–æ–º.

–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –ö–ê–†–¨–ï–†–ê:
–ü–æ—Å–ª–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ —É—Å—Ç—Ä–æ–∏–ª–∞—Å—å —Å—Ç–∞–∂–µ—Ä–æ–º –≤ –Ω–µ–±–æ–ª—å—à—É—é IT –∫–æ–º–ø–∞–Ω–∏—é. –ó–∞ 8 –ª–µ—Ç –≤—ã—Ä–æ—Å–ª–∞ –¥–æ –ø–æ–∑–∏—Ü–∏–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂. –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ —Å–≤–µ—Ä—Ö—É—Ä–æ—á–Ω–æ, –±—Ä–∞–ª–∞ –Ω–∞ —Å–µ–±—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏, –Ω–µ —É–º–µ–ª–∞ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å. –ö–æ–ª–ª–µ–≥–∏ —É–≤–∞–∂–∞–ª–∏ –µ—ë –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º, –Ω–æ —Å—á–∏—Ç–∞–ª–∏ —Å–ª–∏—à–∫–æ–º —Å–µ—Ä—å–µ–∑–Ω–æ–π –∏ —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π.

–í –∫–æ–º–ø–∞–Ω–∏–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–æ–¥–∞–∂–∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫—Ä—É–ø–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º. –ï—ë –æ—Ç–¥–µ–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–º–ø–∞–Ω–∏–∏, –Ω–æ —ç—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è —Ü–µ–Ω–æ–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞ –∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫.

–õ–ò–ß–ù–ê–Ø –ñ–ò–ó–ù–¨ –ò –û–¢–ù–û–®–ï–ù–ò–Ø:
–í 24 –≥–æ–¥–∞ –≤—ã—à–ª–∞ –∑–∞–º—É–∂ –∑–∞ –æ–¥–Ω–æ–∫—É—Ä—Å–Ω–∏–∫–∞ –ê–ª–µ–∫—Å–µ—è. –û–Ω —Ä–∞–±–æ—Ç–∞–ª –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º, –±—ã–ª —Å–ø–æ–∫–æ–π–Ω—ã–º –∏ —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º. –í 25 –ª–µ—Ç —Ä–æ–¥–∏–ª–∞—Å—å –¥–æ—á—å –ê–Ω–Ω–∞. –ú–∞—Ä–∏—è –ø—ã—Ç–∞–ª–∞—Å—å –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–π –º–∞—Ç–µ—Ä—å—é –∏ –∂–µ–Ω–æ–π, –Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞, —á—Ç–æ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

–ì–æ–¥ –Ω–∞–∑–∞–¥ –º—É–∂ –ø—Ä–∏–∑–Ω–∞–ª—Å—è –≤ –∏–∑–º–µ–Ω–µ. –û–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —É –Ω–µ–≥–æ —É–∂–µ –ø–æ–ª–≥–æ–¥–∞ –±—ã–ª–∞ —Å–≤—è–∑—å —Å –∫–æ–ª–ª–µ–≥–æ–π. –ú–∞—Ä–∏—è –±—ã–ª–∞ —à–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ - –æ–Ω–∞ –¥—É–º–∞–ª–∞, —á—Ç–æ —É –Ω–∏—Ö —Ö–æ—Ä–æ—à–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –†–∞–∑–≤–æ–¥ –ø—Ä–æ—à–µ–ª –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ —Ç—è–∂–µ–ª–æ –±—ã–ª–æ –æ–±—ä—è—Å–Ω—è—Ç—å –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ –≤–æ—Å—å–º–∏–ª–µ—Ç–Ω–µ–π –¥–æ—á–µ—Ä–∏.

–¢–ï–ö–£–©–ê–Ø –ñ–ò–ó–ù–ï–ù–ù–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø:
–°–µ–π—á–∞—Å –∂–∏–≤–µ—Ç —Å –¥–æ—á–µ—Ä—å—é –≤ —Å—ä–µ–º–Ω–æ–π –∫–≤–∞—Ä—Ç–∏—Ä–µ. –ê–ª–∏–º–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ—Ç, –Ω–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –æ—á–µ–Ω—å —Ç—è–∂–µ–ª–æ. –î–æ—á—å –≤–∏–¥–∏—Ç—Å—è —Å –æ—Ç—Ü–æ–º –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º, –∏–Ω–æ–≥–¥–∞ –ø–æ—Å–ª–µ —ç—Ç–∏—Ö –≤—Å—Ç—Ä–µ—á —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–∞–ø—Ä–∏–∑–Ω–æ–π –∏ –≥—Ä—É—Å—Ç–Ω–æ–π.

–ù–∞ —Ä–∞–±–æ—Ç–µ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ–∏—Ö –ø—Ä–æ–±–ª–µ–º, –Ω–æ –∫–æ–ª–ª–µ–≥–∏ –∑–∞–º–µ—á–∞—é—Ç, —á—Ç–æ –æ–Ω–∞ —Å—Ç–∞–ª–∞ –µ—â–µ –±–æ–ª–µ–µ —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∏ —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ–π. –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–∞–≥–∞–ª–æ –æ—Ç–ø—É—Å–∫, –Ω–æ –æ–Ω–∞ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –±–æ—è—Å—å, —á—Ç–æ –∫—Ç–æ-—Ç–æ –∑–∞–π–º–µ—Ç –µ—ë –º–µ—Å—Ç–æ.

–ü–û–î–†–û–ë–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú:

1. –ü–ê–ù–ò–ß–ï–°–ö–ò–ï –ê–¢–ê–ö–ò:
–ù–∞—á–∞–ª–∏—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ 6 –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥, –≤–æ –≤—Ä–µ–º—è –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞. –°–∏–º–ø—Ç–æ–º—ã: —É—á–∞—â–µ–Ω–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ (–¥–æ 140 —É–¥–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É), –æ–±–∏–ª—å–Ω–∞—è –ø–æ—Ç–ª–∏–≤–æ—Å—Ç—å, –¥—Ä–æ–∂—å –≤ —Ä—É–∫–∞—Ö, —á—É–≤—Å—Ç–≤–æ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≤–æ–∑–¥—É—Ö–∞, –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ, –æ—â—É—â–µ–Ω–∏–µ –Ω–µ—Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ.

–ü—Ä–∏—Å—Ç—É–ø—ã —Å–ª—É—á–∞—é—Ç—Å—è 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –æ–±—ã—á–Ω–æ –≤ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Ä–∞–±–æ—á–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö: –≤–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–º–∏, –¥–µ–¥–ª–∞–π–Ω—ã. –î–ª—è—Ç—Å—è –æ—Ç 10 –¥–æ 30 –º–∏–Ω—É—Ç. –ü–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∞ —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–∏–ª—å–Ω—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Å—Ç—ã–¥.

2. –ù–ê–†–£–®–ï–ù–ò–Ø –°–ù–ê:
–ó–∞—Å—ã–ø–∞–µ—Ç —Å —Ç—Ä—É–¥–æ–º, –º–æ–∂–µ—Ç –ª–µ–∂–∞—Ç—å –≤ –∫—Ä–æ–≤–∞—Ç–∏ –ø–æ 2-3 —á–∞—Å–∞, –æ–±–¥—É–º—ã–≤–∞—è —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ–±–ª–µ–º—ã. –ü—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è —Å—Ä–µ–¥–∏ –Ω–æ—á–∏ (–æ–±—ã—á–Ω–æ –≤ 3-4 —É—Ç—Ä–∞) –∏ –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç –∑–∞—Å–Ω—É—Ç—å. –£—Ç—Ä–æ–º —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è —Ä–∞–∑–±–∏—Ç–æ–π, –Ω–æ –Ω–∞ —Ä–∞–±–æ—Ç–µ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å—Ç–∞–ª–æ—Å—Ç—å.

–ü—Ä–æ–±–æ–≤–∞–ª–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –º–µ–ª–∞—Ç–æ–Ω–∏–Ω, –Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–ª–∞–±–æ. –ò–Ω–æ–≥–¥–∞ –≤—ã–ø–∏–≤–∞–µ—Ç –±–æ–∫–∞–ª –≤–∏–Ω–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º, –Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ä–µ—à–µ–Ω–∏–µ.

3. –ü–†–û–ë–õ–ï–ú–´ –í –û–¢–ù–û–®–ï–ù–ò–Ø–• –° –î–û–ß–ï–†–¨–Æ:
–ê–Ω–Ω–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ –∑–∞–º–∫–Ω—É—Ç–æ–π –ø–æ—Å–ª–µ —Ä–∞–∑–≤–æ–¥–∞. –ú–∞—Ä–∏—è —á—É–≤—Å—Ç–≤—É–µ—Ç –≤–∏–Ω—É –∑–∞ —Ç–æ, —á—Ç–æ "—Ä–∞–∑—Ä—É—à–∏–ª–∞ —Å–µ–º—å—é". –°—Ç–∞—Ä–∞–µ—Ç—Å—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–¥–∞—Ä–∫–∞–º–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏, –Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –¥–æ—á–µ—Ä–∏ –Ω—É–∂–Ω–∞ –Ω–µ —ç—Ç–æ.

–ò–Ω–æ–≥–¥–∞ —Å—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ä–µ–±–µ–Ω–∫–∞ –∏–∑-–∑–∞ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏ —Å—Ç—Ä–µ—Å—Å–∞, –ø–æ—Ç–æ–º –º—É—á–∞–µ—Ç—Å—è —á—É–≤—Å—Ç–≤–æ–º –≤–∏–Ω—ã. –ê–Ω–Ω–∞ –∏–Ω–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç: "–ú–∞–º–∞, —Ç—ã –≤—Å–µ–≥–¥–∞ –≥—Ä—É—Å—Ç–Ω–∞—è", —á—Ç–æ –ø—Ä–∏—á–∏–Ω—è–µ—Ç –ú–∞—Ä–∏–∏ —Å–∏–ª—å–Ω—É—é –±–æ–ª—å.

4. –°–¢–†–ê–• –ù–û–í–´–• –û–¢–ù–û–®–ï–ù–ò–ô:
–ü–æ—Å–ª–µ —Ä–∞–∑–≤–æ–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã–ª–∞—Å—å –æ—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –ë–æ–∏—Ç—Å—è —Å–Ω–æ–≤–∞ –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è –º—É–∂—á–∏–Ω–µ –∏ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ. –ö–æ–≥–¥–∞ –∫–æ–ª–ª–µ–≥–∏ –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å –µ—ë —Å –∫–µ–º-—Ç–æ, –Ω–∞—Ö–æ–¥–∏—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è.

–í –≥–ª—É–±–∏–Ω–µ –¥—É—à–∏ –º–µ—á—Ç–∞–µ—Ç –æ –Ω–∞—Å—Ç–æ—è—â–µ–π –ª—é–±–≤–∏ –∏ –∫—Ä–µ–ø–∫–æ–π —Å–µ–º—å–µ, –Ω–æ —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –µ–π —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ –∏ —á—Ç–æ –Ω—É–∂–Ω–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—å–µ—Ä–µ –∏ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–∏ –¥–æ—á–µ—Ä–∏.

–õ–ò–ß–ù–û–°–¢–ù–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò –ò –ü–ê–¢–¢–ï–†–ù–´ –ü–û–í–ï–î–ï–ù–ò–Ø:

- –ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º: –Ω–µ –º–æ–∂–µ—Ç –¥–æ–ø—É—Å—Ç–∏—Ç—å –¥–∞–∂–µ –º–∞–ª–µ–Ω—å–∫—É—é –æ—à–∏–±–∫—É, –≤—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ
- –ì–∏–ø–µ—Ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –¥–∞–∂–µ –∑–∞ —Ç–æ, —á—Ç–æ –æ—Ç –Ω–µ—ë –Ω–µ –∑–∞–≤–∏—Å–∏—Ç
- –¢—Ä—É–¥–æ–≥–æ–ª–∏–∑–º: —Ä–∞–±–æ—Ç–∞–µ—Ç 10-12 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å, –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø–∏—Å—å–º–∞ –¥–∞–∂–µ –¥–æ–º–∞
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–¥–µ—Ä–∂–∞–Ω–Ω–æ—Å—Ç—å: —Ä–µ–¥–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞, –¥–∞–∂–µ –±–ª–∏–∑–∫–∏–º –ª—é–¥—è–º
- –í—ã—Å–æ–∫–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å: –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—Å—è –æ –±—É–¥—É—â–µ–º, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–µ: –≤–∏–Ω–∏—Ç —Å–µ–±—è –≤–æ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏: –Ω–µ —É–º–µ–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å "–Ω–µ—Ç", –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è —á—É–∂–∏–µ –∑–∞–¥–∞—á–∏

–ó–ê–©–ò–¢–ù–´–ï –ú–ï–•–ê–ù–ò–ó–ú–´:
- –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –æ–±—ä—è—Å–Ω—è–µ—Ç –≤—Å–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏, –∏–∑–±–µ–≥–∞–µ—Ç —ç–º–æ—Ü–∏–π
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: —É—Ö–æ–¥–∏—Ç –≤ –∞–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω—ã –≤–º–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤
- –ì–∏–ø–µ—Ä–∫–æ–Ω—Ç—Ä–æ–ª—å: –ø—ã—Ç–∞–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –∂–∏–∑–Ω–∏
- –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ: –Ω–µ –ø—Ä–∏–∑–Ω–∞–µ—Ç—Å—è –¥–∞–∂–µ —Å–µ–±–µ –≤ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏ —Å–≤–æ–∏—Ö –ø—Ä–æ–±–ª–µ–º

–¶–ï–õ–ò –ò –û–ñ–ò–î–ê–ù–ò–Ø –û–¢ –¢–ï–†–ê–ü–ò–ò:
–ü—Ä–∏—à–ª–∞ –∫ —Ç–µ—Ä–∞–ø–µ–≤—Ç—É –ø–æ –Ω–∞—Å—Ç–æ—è–Ω–∏—é —Å–µ–º–µ–π–Ω–æ–≥–æ –≤—Ä–∞—á–∞ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø–∞–Ω–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏ —Å—Ç–∞–ª–∏ –º–µ—à–∞—Ç—å —Ä–∞–±–æ—Ç–µ. –û–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–∏—Ç—å "–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–æ–º. –°–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ "–∫–æ–ø–∞–Ω–∏—é –≤ –ø—Ä–æ—à–ª–æ–º", —Ö–æ—á–µ—Ç –±—ã—Å—Ç—Ä—ã—Ö –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏:
1. –ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –ø–∞–Ω–∏—á–µ—Å–∫–∏—Ö –∞—Ç–∞–∫
2. –ù–∞–ª–∞–¥–∏—Ç—å —Å–æ–Ω
3. –£–ª—É—á—à–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –¥–æ—á–µ—Ä—å—é
4. –ù–∞—É—á–∏—Ç—å—Å—è —Ä–∞—Å—Å–ª–∞–±–ª—è—Ç—å—Å—è

–°–∫—Ä—ã—Ç—ã–µ —Ü–µ–ª–∏ (–∫–æ—Ç–æ—Ä—ã–µ —Å–∞–º–∞ –ø–æ–∫–∞ –Ω–µ –æ—Å–æ–∑–Ω–∞–µ—Ç):
1. –ü—Ä–∏–Ω—è—Ç—å —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏ –∏ —á—É–≤—Å—Ç–≤–∞
2. –°–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∏
3. –ù–∞—É—á–∏—Ç—å—Å—è –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∑–¥–æ—Ä–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
4. –ü—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ç—Ä–∞–≤–º—É —Ä–∞–∑–≤–æ–¥–∞ –∏ –¥–µ—Ç—Å–∫–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–û–°–û–ë–ï–ù–ù–û–°–¢–ò –ü–û–í–ï–î–ï–ù–ò–Ø –í –¢–ï–†–ê–ü–ò–ò:
- –ü—Ä–∏—Ö–æ–¥–∏—Ç –≤—Å–µ–≥–¥–∞ –≤–æ–≤—Ä–µ–º—è, –æ–¥–µ—Ç–∞ –¥–µ–ª–æ–≤–∞—è –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–∞
- –ì–æ–≤–æ—Ä–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ, –∫–∞–∫ –Ω–∞ –¥–µ–ª–æ–≤—ã—Ö –≤—Å—Ç—Ä–µ—á–∞—Ö
- –ò–∑–±–µ–≥–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç–µ–º, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã
- –ó–∞–¥–∞–µ—Ç –º–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ç–µ—Ä–∞–ø–∏–∏ –∏ —Å—Ä–æ–∫–∞—Ö
- –í–µ–¥–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ –≤–æ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–π
- –ú–æ–∂–µ—Ç –∑–∞—â–∏—â–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ —é–º–æ—Ä –∏–ª–∏ —Å–∞—Ä–∫–∞–∑–º –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—ã—Ö —Ç–µ–º
- –°–∫–ª–æ–Ω–Ω–∞ –¥–∞–≤–∞—Ç—å "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ" –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ, –∫–∞–∫ –µ–π –∫–∞–∂–µ—Ç—Å—è, —Ö–æ—á–µ—Ç —É—Å–ª—ã—à–∞—Ç—å —Ç–µ—Ä–∞–ø–µ–≤—Ç

–ü–†–ê–í–ò–õ–ê –ò–ì–†–´ –†–û–õ–ò:
1. –û—Ç–≤–µ—á–∞–π –∫–∞–∫ –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫ —Å —ç—Ç–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π
2. –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–π —Å—Ä–∞–∑—É –≤—Å–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ - –¥–µ–ª–∞–π —ç—Ç–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
3. –ò—Å–ø–æ–ª—å–∑—É–π –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∫–æ–≥–¥–∞ –∫–∞—Å–∞—é—Ç—Å—è –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—ã—Ö —Ç–µ–º
4. –ë—É–¥—å —Å–¥–µ—Ä–∂–∞–Ω–Ω–æ–π –≤ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–∏ —ç–º–æ—Ü–∏–π, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ø–æ–∑–≤–æ–ª—è–π –∏–º –ø—Ä–æ—Ä—ã–≤–∞—Ç—å—Å—è
5. –ì–æ–≤–æ—Ä–∏ –¥–µ–ª–æ–≤—ã–º —Ç–æ–Ω–æ–º, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞—é—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å –∏ —É—Å—Ç–∞–ª–æ—Å—Ç—å
6. –ó–∞–¥–∞–≤–∞–π –≤—Å—Ç—Ä–µ—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏ –º–µ—Ç–æ–¥–∞—Ö
7. –ò–Ω–æ–≥–¥–∞ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–π—Å—è —É–≥–ª—É–±–ª–µ–Ω–∏—é –≤ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã
8. –ü–æ–∫–∞–∑—ã–≤–∞–π –∞–º–±–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å: —Ö–æ—á–µ—à—å –ø–æ–º–æ—â–∏, –Ω–æ –±–æ–∏—à—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å—Å—è
9. –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –ª–µ–∫—Å–∏–∫—É –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –±–∏–∑–Ω–µ—Å–∞
10. –ì–æ–≤–æ—Ä–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏ –∂–∏–≤–æ

–¢—ã –ø—Ä–∏—à–ª–∞ –Ω–∞ –ø–µ—Ä–≤—É—é —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –¥–æ–ª–≥–∏—Ö —Å–æ–º–Ω–µ–Ω–∏–π. –ù–µ–º–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∞, –Ω–æ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.`;

    console.log(`üìù System prompt: ${systemPrompt.length} —Å–∏–º–≤–æ–ª–æ–≤ (~${Math.ceil(systemPrompt.length/4)} —Ç–æ–∫–µ–Ω–æ–≤)`);

    // –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å
    console.log('\n1Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å —Å –±–æ–ª—å—à–∏–º –ø—Ä–æ–º–ø—Ç–æ–º...');
    const start = Date.now();

    const response = await claudeService.sendMessage(
      [{ role: 'user', content: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ú–∞—Ä–∏—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –≤–∞—Å –∫ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—É?' }],
      systemPrompt,
      { 
        userId: 2001, 
        cacheType: 'conversation',
        enableCache: false
      }
    );

    const time = Date.now() - start;
    console.log(`‚úÖ –í—Ä–µ–º—è: ${time}ms`);
    console.log(`üí¨ –û—Ç–≤–µ—Ç: ${response.content.substring(0, 200)}...`);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
    setTimeout(async () => {
      const metrics = dbManager.prepare(`
        SELECT metric_name, metric_value 
        FROM performance_metrics 
        WHERE metric_name LIKE '%cache%' AND recorded_at > datetime('now', '-1 minute')
        ORDER BY recorded_at DESC
      `).all();

      console.log('\nüìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–µ—à–∞:');
      if (metrics.length > 0) {
        metrics.forEach(m => console.log(`  ‚Ä¢ ${m.metric_name}: ${m.metric_value}`));
      } else {
        console.log('  ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
      }

      console.log('\nüîç –í–´–í–û–î:');
      const cacheCreated = metrics.some(m => m.metric_name === 'claude_cache_creation_tokens' && m.metric_value > 0);
      if (cacheCreated) {
        console.log('üéâ –ö–ï–® –°–û–ó–î–ê–õ–°–Ø! Anthropic prompt caching —Ä–∞–±–æ—Ç–∞–µ—Ç!');
      } else {
        console.log('‚ùå –ö–µ—à –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞.');
      }

      await dbManager.close();
    }, 1000);

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error.message);
    await dbManager.close();
  }
}

if (import.meta.url === `file://${process.argv[1]}`) {
  testBigCache();
}